@model GameLoggd.Models.Admin.AdminDashboardViewModel
@{
    ViewData["Title"] = "Admin Dashboard";
    var status = TempData["StatusMessage"] as string;
    var statusType = (TempData["StatusType"] as string) ?? "info"; 
}

<div class="w-full min-h-screen pt-24 pb-12 px-4">
    <div class="max-w-7xl mx-auto space-y-8">
        
        <!-- Header -->
        <div class="flex flex-col gap-2">
            <h1 class="text-4xl font-bold font-display text-white tracking-tighter">Admin Control Deck</h1>
            <p class="text-white/50 font-medium">System Overview & Management</p>
        </div>

        <div id="admin-dashboard-content">

        @if (!string.IsNullOrWhiteSpace(status))
        {
            var statusClass = statusType == "success" ? "text-primary border-primary/20 bg-primary/10" : 
                              statusType == "danger" ? "text-red-500 border-red-500/20 bg-red-500/10" : 
                              "text-blue-400 border-blue-400/20 bg-blue-400/10";
                              
            <div class="p-4 rounded-lg border @statusClass flex items-center gap-3 font-bold animate-in fade-in slide-in-from-top-2">
                <span class="material-symbols-outlined">info</span>
                <span>@status</span>
            </div>
        }

        <!-- Stats Row -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white/5 border border-white/10 rounded-xl p-6 relative overflow-hidden group hover:border-accent-cyan/50 transition-colors">
                <div class="flex items-center gap-4 relative z-10">
                    <div class="w-14 h-14 rounded-xl bg-accent-cyan/10 border border-accent-cyan/20 flex items-center justify-center text-accent-cyan group-hover:scale-110 transition-transform">
                        <span class="material-symbols-outlined text-3xl">group</span>
                    </div>
                    <div>
                        <p class="text-3xl font-bold text-white font-display tracking-tight">@Model.TotalUsers</p>
                        <p class="text-white/50 text-xs font-bold uppercase tracking-widest">Total Users</p>
                    </div>
                </div>
                <div class="absolute -right-4 -bottom-4 text-accent-cyan/5 text-9xl font-display font-black select-none pointer-events-none">USR</div>
            </div>

            <div class="bg-white/5 border border-white/10 rounded-xl p-6 relative overflow-hidden group hover:border-red-500/50 transition-colors">
                <div class="flex items-center gap-4 relative z-10">
                    <div class="w-14 h-14 rounded-xl bg-red-500/10 border border-red-500/20 flex items-center justify-center text-red-500 group-hover:scale-110 transition-transform">
                        <span class="material-symbols-outlined text-3xl">rate_review</span>
                    </div>
                    <div>
                        <p class="text-3xl font-bold text-white font-display tracking-tight">@Model.TotalReviews</p>
                        <p class="text-white/50 text-xs font-bold uppercase tracking-widest">Total Reviews</p>
                    </div>
                </div>
                 <div class="absolute -right-4 -bottom-4 text-red-500/5 text-9xl font-display font-black select-none pointer-events-none">REV</div>
            </div>

            <div class="bg-white/5 border border-white/10 rounded-xl p-6 relative overflow-hidden group hover:border-primary/50 transition-colors">
                <div class="flex items-center gap-4 relative z-10">
                    <div class="w-14 h-14 rounded-xl bg-primary/10 border border-primary/20 flex items-center justify-center text-primary group-hover:scale-110 transition-transform">
                        <span class="material-symbols-outlined text-3xl">sports_esports</span>
                    </div>
                    <div>
                        <p class="text-3xl font-bold text-white font-display tracking-tight">@Model.TotalGames</p>
                        <p class="text-white/50 text-xs font-bold uppercase tracking-widest">Total Games</p>
                    </div>
                </div>
                 <div class="absolute -right-4 -bottom-4 text-primary/5 text-9xl font-display font-black select-none pointer-events-none">GMS</div>
            </div>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
            
            <!-- Games Management Column -->
            <div class="space-y-6">
                <div class="bg-white/5 border border-white/10 rounded-xl p-6 md:p-8 backdrop-blur-sm">
                    <div class="flex flex-col gap-1 mb-6 pb-4 border-b border-white/10">
                        <h2 class="text-2xl font-bold text-white font-display flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">stadia_controller</span>
                            Game Database
                        </h2>
                        <p class="text-white/50 text-sm">Add, remove, or modify game entries.</p>
                    </div>

                    @if (Model.EditingGame is not null)
                    {
                        <div class="mb-4 text-primary text-sm font-bold uppercase tracking-widest flex items-center gap-2">
                            <span class="material-symbols-outlined text-lg">edit</span>
                            Editing: @Model.EditingGame.Title
                        </div>
                        
                        <form method="post" action="/admin/games/update" class="space-y-5" enctype="multipart/form-data">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="id" value="@Model.EditingGame.Id" />

                            <div class="grid grid-cols-3 gap-4">
                                <div class="col-span-2 space-y-2">
                                    <label class="text-xs font-bold uppercase tracking-widest text-white/50">Title</label>
                                    <input name="title" value="@Model.EditingGame.Title" class="admin-input" placeholder="Game Title" />
                                </div>
                                <div class="space-y-2">
                                    <label class="text-xs font-bold uppercase tracking-widest text-white/50">Year</label>
                                    <input name="year" inputmode="numeric" value="@(Model.EditingGame.Year?.ToString() ?? string.Empty)" class="admin-input" placeholder="YYYY" />
                                </div>
                            </div>

                            <div class="space-y-2">
                                <label class="text-xs font-bold uppercase tracking-widest text-white/50">Developer</label>
                                <input name="developer" value="@Model.EditingGame.Developer" class="admin-input" placeholder="Developer Name" />
                            </div>

                            <div class="space-y-2">
                                <label class="text-xs font-bold uppercase tracking-widest text-white/50">Description</label>
                                <textarea name="description" rows="3" class="admin-input resize-none" placeholder="Short description...">@Model.EditingGame.Description</textarea>
                            </div>

                            <div class="grid md:grid-cols-2 gap-4">
                                <!-- Edit Genres -->
                                <div class="space-y-2">
                                    <label class="text-xs font-bold uppercase tracking-widest text-white/50">Genres</label>
                                    <div class="min-h-[42px] p-2 bg-black/20 border border-white/10 rounded-lg flex flex-wrap gap-2" id="edit-genre-tags">
                                         @foreach(var g in Model.EditingGame.Genres)
                                        {
                                            <div class="px-2 py-1 rounded bg-primary/20 text-primary text-xs font-bold flex items-center gap-1" data-id="@g.Id">
                                                @g.Name
                                                <span class="hover:text-white cursor-pointer" onclick="removeTag(this, 'edit-genre', '@g.Id')">×</span>
                                            </div>
                                        }
                                    </div>
                                    <div class="flex gap-2">
                                        <select id="edit-genre-select" class="admin-select flex-1">
                                            <option value="">Select Genre...</option>
                                            @foreach (var g in Model.AvailableGenres) { <option value="@g.Id">@g.Name</option> }
                                        </select>
                                        <button type="button" class="admin-btn-secondary" onclick="addTag('edit-genre', 'genreIds')">Add</button>
                                    </div>
                                    <div id="edit-genre-inputs">
                                        @foreach(var g in Model.EditingGame.Genres) { <input type="hidden" name="genreIds" value="@g.Id" id="input-edit-genre-@g.Id" /> }
                                    </div>
                                </div>

                                <!-- Edit Platforms -->
                                <div class="space-y-2">
                                    <label class="text-xs font-bold uppercase tracking-widest text-white/50">Platforms</label>
                                    <div class="min-h-[42px] p-2 bg-black/20 border border-white/10 rounded-lg flex flex-wrap gap-2" id="edit-platform-tags">
                                        @foreach(var p in Model.EditingGame.Platforms)
                                        {
                                            <div class="px-2 py-1 rounded bg-accent-purple/20 text-accent-purple text-xs font-bold flex items-center gap-1" data-id="@p.Id">
                                                @p.Name
                                                <span class="hover:text-white cursor-pointer" onclick="removeTag(this, 'edit-platform', '@p.Id')">×</span>
                                            </div>
                                        }
                                    </div>
                                    <div class="flex gap-2">
                                        <select id="edit-platform-select" class="admin-select flex-1">
                                            <option value="">Select Platform...</option>
                                            @foreach (var p in Model.AvailablePlatforms) { <option value="@p.Id">@p.Name</option> }
                                        </select>
                                        <button type="button" class="admin-btn-secondary" onclick="addTag('edit-platform', 'platformIds')">Add</button>
                                    </div>
                                    <div id="edit-platform-inputs">
                                        @foreach(var p in Model.EditingGame.Platforms) { <input type="hidden" name="platformIds" value="@p.Id" id="input-edit-platform-@p.Id" /> }
                                    </div>
                                </div>
                            </div>

                            <div class="space-y-2">
                                <label class="text-xs font-bold uppercase tracking-widest text-white/50">Changes Image</label>
                                <div class="flex items-center gap-4">
                                     @if (!string.IsNullOrWhiteSpace(Model.EditingGame.ImagePath))
                                    {
                                        <img src="@Model.EditingGame.ImagePath" class="h-16 w-12 object-cover rounded border border-white/10" />
                                    }
                                    <input name="image" type="file" accept="image/*" class="admin-file-input w-full" />
                                </div>
                            </div>

                            <div class="flex gap-3 pt-4 border-t border-white/10">
                                <button class="admin-btn-primary flex-1" type="submit">Save Changes</button>
                                <a class="admin-btn-base bg-white/5 hover:bg-white/10 text-white flex-1 text-center" href="/admin">Cancel</a>
                            </div>
                        </form>
                    }
                    else
                    {
                        <form method="post" action="/admin/games/add" class="space-y-5" enctype="multipart/form-data">
                            @Html.AntiForgeryToken()
                             <div class="grid grid-cols-3 gap-4">
                                <div class="col-span-2 space-y-2">
                                    <label class="text-xs font-bold uppercase tracking-widest text-white/50">Title</label>
                                    <input name="title" class="admin-input" placeholder="Cyberpunk Legends..." />
                                </div>
                                <div class="space-y-2">
                                    <label class="text-xs font-bold uppercase tracking-widest text-white/50">Year</label>
                                    <input name="year" inputmode="numeric" class="admin-input" placeholder="2024" />
                                </div>
                            </div>

                            <div class="space-y-2">
                                <label class="text-xs font-bold uppercase tracking-widest text-white/50">Developer</label>
                                <input name="developer" class="admin-input" placeholder="Neon Studios" />
                            </div>

                            <div class="space-y-2">
                                <label class="text-xs font-bold uppercase tracking-widest text-white/50">Description</label>
                                <textarea name="description" rows="3" class="admin-input resize-none" placeholder="Short description..."></textarea>
                            </div>

                             <div class="grid md:grid-cols-2 gap-4">
                                <!-- Add Genres -->
                                <div class="space-y-2">
                                    <label class="text-xs font-bold uppercase tracking-widest text-white/50">Genres</label>
                                    <div class="min-h-[42px] p-2 bg-black/20 border border-white/10 rounded-lg flex flex-wrap gap-2" id="add-genre-tags"></div>
                                    <div class="flex gap-2">
                                        <select id="add-genre-select" class="admin-select flex-1">
                                            <option value="">Select Genre...</option>
                                            @foreach (var g in Model.AvailableGenres) { <option value="@g.Id">@g.Name</option> }
                                        </select>
                                        <button type="button" class="admin-btn-secondary" onclick="addTag('add-genre', 'genreIds')">Add</button>
                                    </div>
                                    <div id="add-genre-inputs"></div>
                                </div>

                                <!-- Add Platforms -->
                                <div class="space-y-2">
                                    <label class="text-xs font-bold uppercase tracking-widest text-white/50">Platforms</label>
                                    <div class="min-h-[42px] p-2 bg-black/20 border border-white/10 rounded-lg flex flex-wrap gap-2" id="add-platform-tags"></div>
                                    <div class="flex gap-2">
                                        <select id="add-platform-select" class="admin-select flex-1">
                                            <option value="">Select Platform...</option>
                                            @foreach (var p in Model.AvailablePlatforms) { <option value="@p.Id">@p.Name</option> }
                                        </select>
                                        <button type="button" class="admin-btn-secondary" onclick="addTag('add-platform', 'platformIds')">Add</button>
                                    </div>
                                    <div id="add-platform-inputs"></div>
                                </div>
                            </div>

                            <div class="space-y-2">
                                <label class="text-xs font-bold uppercase tracking-widest text-white/50">Game Image</label>
                                <input name="image" type="file" accept="image/*" class="admin-file-input w-full" />
                            </div>

                            <button class="admin-btn-primary w-full mt-4" type="submit">Add Game to Database</button>
                        </form>
                    }

                    <!-- Games List -->
                    <div class="mt-8 space-y-3">
                        <h3 class="text-lg font-bold text-white border-b border-white/10 pb-2">Recent Games</h3>
                        <div class="space-y-2">
                            @foreach (var game in Model.Games)
                            {
                                <div class="bg-black/20 border border-white/5 rounded-lg p-3 flex items-center justify-between group hover:border-white/20 transition-all">
                                    <a href="/admin?editGameId=@game.Id" class="flex items-center gap-3 flex-1 min-w-0">
                                        @if (!string.IsNullOrWhiteSpace(game.ImagePath))
                                        {
                                            <img src="@game.ImagePath" class="w-10 h-14 object-cover rounded bg-white/5 border border-white/10" />
                                        }
                                        else
                                        {
                                            <div class="w-10 h-14 rounded bg-white/5 border border-white/10 flex items-center justify-center text-white/20">
                                                <span class="material-symbols-outlined text-sm">image</span>
                                            </div>
                                        }
                                        <div class="flex flex-col min-w-0">
                                            <span class="text-white font-bold truncate group-hover:text-primary transition-colors">@game.Title</span>
                                            <div class="flex items-center gap-2 text-xs text-white/40 font-mono">
                                                <span>@(game.Year?.ToString() ?? "—")</span>
                                                <span>•</span>
                                                <span class="truncate">@(string.IsNullOrWhiteSpace(game.Developer) ? "—" : game.Developer)</span>
                                            </div>
                                        </div>
                                    </a>
                                    
                                    <form method="post" action="/admin/games/delete" onsubmit="return confirm('Are you sure you want to delete this game?');">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="id" value="@game.Id" />
                                        <button type="submit" class="p-2 text-white/20 hover:text-red-500 hover:bg-red-500/10 rounded-lg transition-colors">
                                            <span class="material-symbols-outlined text-xl">delete</span>
                                        </button>
                                    </form>
                                </div>
                            }
                        </div>

                        <!-- Games Pagination -->
                        <div class="flex items-center justify-between pt-4">
                         @if (Model.Games.HasPreviousPage) { 
                             <a href="/admin?gamePage=@(Model.Games.PageIndex - 1)&userPage=@Model.Users.PageIndex&reviewPage=@Model.Reviews.PageIndex&commentPage=@Model.ReviewComments.PageIndex" class="px-3 py-1 bg-white/5 rounded hover:bg-white/10 text-xs font-bold text-white">PREV</a>
                         } else { <span class="px-3 py-1 bg-white/5 rounded opacity-50 text-xs font-bold text-white/50 cursor-not-allowed">PREV</span> }
                         
                         <span class="text-xs font-ibm-plex-mono text-white/50">Pg @Model.Games.PageIndex / @Model.Games.TotalPages</span>
                         
                         @if (Model.Games.HasNextPage) { 
                             <a href="/admin?gamePage=@(Model.Games.PageIndex + 1)&userPage=@Model.Users.PageIndex&reviewPage=@Model.Reviews.PageIndex&commentPage=@Model.ReviewComments.PageIndex" class="px-3 py-1 bg-white/5 rounded hover:bg-white/10 text-xs font-bold text-white">NEXT</a>
                         } else { <span class="px-3 py-1 bg-white/5 rounded opacity-50 text-xs font-bold text-white/50 cursor-not-allowed">NEXT</span> }
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Management Column -->
            <div class="space-y-6">
                 <div class="bg-white/5 border border-white/10 rounded-xl p-6 md:p-8 backdrop-blur-sm min-h-[360px]">
                    <div class="flex flex-col gap-1 mb-6 pb-4 border-b border-white/10">
                        <h2 class="text-2xl font-bold text-white font-display flex items-center gap-2">
                            <span class="material-symbols-outlined text-accent-purple">admin_panel_settings</span>
                            User Management
                        </h2>
                        <p class="text-white/50 text-sm">Monitor user status and moderation.</p>
                    </div>

                    <div class="space-y-3">
                        @foreach (var user in Model.Users)
                        {
                            <div class="bg-black/20 border border-white/5 rounded-lg p-4 flex items-center justify-between group hover:border-white/20 transition-all">
                                <div class="flex flex-col min-w-0">
                                    <div class="flex items-center gap-2">
                                        <span class="text-white font-bold truncate">@(string.IsNullOrWhiteSpace(user.UserName) ? "No Username" : user.UserName)</span>
                                        @if(user.IsBanned) {
                                            <span class="px-1.5 py-0.5 bg-red-500/10 text-red-500 text-[10px] font-bold uppercase tracking-wider border border-red-500/20 rounded">Banned</span>
                                        } else {
                                            <span class="px-1.5 py-0.5 bg-green-500/10 text-green-500 text-[10px] font-bold uppercase tracking-wider border border-green-500/20 rounded">Active</span>
                                        }
                                    </div>
                                    <span class="text-xs text-white/40 font-mono truncate">@(string.IsNullOrWhiteSpace(user.Email) ? "No Email" : user.Email)</span>
                                </div>

                                @if (user.IsBanned)
                                {
                                    <form method="post" action="/admin/users/unban">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="id" value="@user.Id" />
                                        <button type="submit" class="px-3 py-1.5 bg-green-500/10 hover:bg-green-500/20 text-green-500 border border-green-500/20 rounded text-xs font-bold uppercase tracking-wide transition-colors">Unban</button>
                                    </form>
                                }
                                else
                                {
                                    <form method="post" action="/admin/users/ban" onsubmit="return confirm('Are you sure you want to ban this user?');">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="id" value="@user.Id" />
                                        <button type="submit" class="px-3 py-1.5 bg-red-500/10 hover:bg-red-500/20 text-red-500 border border-red-500/20 rounded text-xs font-bold uppercase tracking-wide transition-colors">Ban</button>
                                    </form>
                                }
                            </div>
                        }
                    </div>

                     <!-- Users Pagination -->
                    <div class="flex items-center justify-between pt-4 mt-4 shrink-0">
                         @if (Model.Users.HasPreviousPage) { 
                             <a href="/admin?userPage=@(Model.Users.PageIndex - 1)&gamePage=@Model.Games.PageIndex&reviewPage=@Model.Reviews.PageIndex&commentPage=@Model.ReviewComments.PageIndex" class="px-3 py-1 bg-white/5 rounded hover:bg-white/10 text-xs font-bold text-white">PREV</a>
                         } else { <span class="px-3 py-1 bg-white/5 rounded opacity-50 text-xs font-bold text-white/50 cursor-not-allowed">PREV</span> }
                         
                         <span class="text-xs font-ibm-plex-mono text-white/50">Pg @Model.Users.PageIndex / @Model.Users.TotalPages</span>
                         
                         @if (Model.Users.HasNextPage) { 
                             <a href="/admin?userPage=@(Model.Users.PageIndex + 1)&gamePage=@Model.Games.PageIndex&reviewPage=@Model.Reviews.PageIndex&commentPage=@Model.ReviewComments.PageIndex" class="px-3 py-1 bg-white/5 rounded hover:bg-white/10 text-xs font-bold text-white">NEXT</a>
                         } else { <span class="px-3 py-1 bg-white/5 rounded opacity-50 text-xs font-bold text-white/50 cursor-not-allowed">NEXT</span> }
                    </div>
                </div>

                <!-- Reviews Management -->
                <div class="bg-white/5 border border-white/10 rounded-xl p-6 md:p-8 backdrop-blur-sm min-h-[360px]">
                    <div class="flex flex-col gap-1 mb-6 pb-4 border-b border-white/10">
                        <h2 class="text-2xl font-bold text-white font-display flex items-center gap-2">
                            <span class="material-symbols-outlined text-red-500">rate_review</span>
                            Review Moderation
                        </h2>
                        <p class="text-white/50 text-sm">View and delete user reviews.</p>
                    </div>

                    <div class="space-y-3">
                        @if (Model.Reviews.Count == 0)
                        {
                            <div class="bg-black/20 border border-white/5 rounded-lg p-4 text-white/50 text-sm">
                                No reviews found.
                            </div>
                        }
                        else
                        {
                            @foreach (var review in Model.Reviews)
                            {
                                var username = string.IsNullOrWhiteSpace(review.User?.UserName) ? "Unknown" : review.User.UserName;
                                var gameTitle = string.IsNullOrWhiteSpace(review.Game?.Title) ? "Unknown Game" : review.Game.Title;
                                var gameSlug = review.Game?.Slug;
                                var preview = string.IsNullOrWhiteSpace(review.Content)
                                    ? "—"
                                    : (review.Content.Length > 180 ? review.Content.Substring(0, 180) + "…" : review.Content);

                                <div class="bg-black/20 border border-white/5 rounded-lg p-4 flex items-start justify-between gap-4 group hover:border-white/20 transition-all">
                                    <div class="min-w-0 flex-1">
                                        <div class="flex items-center gap-2 flex-wrap">
                                            @if (!string.IsNullOrWhiteSpace(gameSlug))
                                            {
                                                <a href="/game/@gameSlug" class="text-white font-bold hover:text-primary transition-colors truncate">@gameTitle</a>
                                            }
                                            else
                                            {
                                                <span class="text-white font-bold truncate">@gameTitle</span>
                                            }
                                            <span class="px-2 py-0.5 bg-white/5 border border-white/10 rounded text-[10px] text-white/70 font-bold uppercase tracking-wider">
                                                ★ @review.Rating.ToString("0.0")
                                            </span>
                                        </div>
                                        <div class="text-xs text-white/40 font-mono mt-1">
                                            by @username • @review.CreatedAt.ToLocalTime().ToString("yyyy-MM-dd HH:mm")
                                        </div>
                                        <div class="text-sm text-white/70 mt-2">
                                            @preview
                                        </div>
                                    </div>

                                    <form method="post" action="/admin/reviews/delete" onsubmit="return confirm('Delete this review?');" class="shrink-0">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="id" value="@review.Id" />
                                        <button type="submit" class="p-2 text-white/20 hover:text-red-500 hover:bg-red-500/10 rounded-lg transition-colors" title="Delete review">
                                            <span class="material-symbols-outlined text-xl">delete</span>
                                        </button>
                                    </form>
                                </div>
                            }
                        }
                    </div>

                    <!-- Reviews Pagination -->
                    <div class="flex items-center justify-between pt-4 mt-4 shrink-0">
                        @if (Model.Reviews.HasPreviousPage)
                        {
                            <a href="/admin?reviewPage=@(Model.Reviews.PageIndex - 1)&gamePage=@Model.Games.PageIndex&userPage=@Model.Users.PageIndex&commentPage=@Model.ReviewComments.PageIndex" class="px-3 py-1 bg-white/5 rounded hover:bg-white/10 text-xs font-bold text-white">PREV</a>
                        }
                        else
                        {
                            <span class="px-3 py-1 bg-white/5 rounded opacity-50 text-xs font-bold text-white/50 cursor-not-allowed">PREV</span>
                        }

                        <span class="text-xs font-ibm-plex-mono text-white/50">Pg @Model.Reviews.PageIndex / @Model.Reviews.TotalPages</span>

                        @if (Model.Reviews.HasNextPage)
                        {
                            <a href="/admin?reviewPage=@(Model.Reviews.PageIndex + 1)&gamePage=@Model.Games.PageIndex&userPage=@Model.Users.PageIndex&commentPage=@Model.ReviewComments.PageIndex" class="px-3 py-1 bg-white/5 rounded hover:bg-white/10 text-xs font-bold text-white">NEXT</a>
                        }
                        else
                        {
                            <span class="px-3 py-1 bg-white/5 rounded opacity-50 text-xs font-bold text-white/50 cursor-not-allowed">NEXT</span>
                        }
                    </div>
                </div>

                <!-- Review Comment Moderation -->
                <div class="bg-white/5 border border-white/10 rounded-xl p-6 md:p-8 backdrop-blur-sm min-h-[360px]">
                    <div class="flex flex-col gap-1 mb-6 pb-4 border-b border-white/10">
                        <h2 class="text-2xl font-bold text-white font-display flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">chat_bubble</span>
                            Review Comments
                        </h2>
                        <p class="text-white/50 text-sm">View and delete review comments.</p>
                    </div>

                    <div class="space-y-3">
                        @if (Model.ReviewComments.Count == 0)
                        {
                            <div class="bg-black/20 border border-white/5 rounded-lg p-4 text-white/50 text-sm">
                                No comments found.
                            </div>
                        }
                        else
                        {
                            @foreach (var c in Model.ReviewComments)
                            {
                                var username = string.IsNullOrWhiteSpace(c.User?.UserName) ? "Unknown" : c.User.UserName;
                                var gameTitle = string.IsNullOrWhiteSpace(c.Review?.Game?.Title) ? "Unknown Game" : c.Review.Game.Title;
                                var gameSlug = c.Review?.Game?.Slug;
                                var text = string.IsNullOrWhiteSpace(c.Content) ? "—" : (c.Content.Length > 200 ? c.Content.Substring(0, 200) + "…" : c.Content);

                                <div class="bg-black/20 border border-white/5 rounded-lg p-4 flex items-start justify-between gap-4 group hover:border-white/20 transition-all">
                                    <div class="min-w-0 flex-1">
                                        <div class="flex items-center gap-2 flex-wrap">
                                            @if (!string.IsNullOrWhiteSpace(gameSlug))
                                            {
                                                <a href="/game/@gameSlug" class="text-white font-bold hover:text-primary transition-colors truncate">@gameTitle</a>
                                            }
                                            else
                                            {
                                                <span class="text-white font-bold truncate">@gameTitle</span>
                                            }
                                            <span class="text-xs text-white/40 font-mono">by @username</span>
                                        </div>
                                        <div class="text-xs text-white/40 font-mono mt-1">
                                            @c.CreatedAt.ToLocalTime().ToString("yyyy-MM-dd HH:mm")
                                        </div>
                                        <div class="text-sm text-white/70 mt-2">
                                            @text
                                        </div>
                                    </div>

                                    <form method="post" action="/admin/review-comments/delete" onsubmit="return confirm('Delete this comment?');" class="shrink-0">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="id" value="@c.Id" />
                                        <button type="submit" class="p-2 text-white/20 hover:text-red-500 hover:bg-red-500/10 rounded-lg transition-colors" title="Delete comment">
                                            <span class="material-symbols-outlined text-xl">delete</span>
                                        </button>
                                    </form>
                                </div>
                            }
                        }
                    </div>

                    <!-- Comments Pagination -->
                    <div class="flex items-center justify-between pt-4 mt-4 shrink-0">
                        @if (Model.ReviewComments.HasPreviousPage)
                        {
                            <a href="/admin?commentPage=@(Model.ReviewComments.PageIndex - 1)&reviewPage=@Model.Reviews.PageIndex&gamePage=@Model.Games.PageIndex&userPage=@Model.Users.PageIndex" class="px-3 py-1 bg-white/5 rounded hover:bg-white/10 text-xs font-bold text-white">PREV</a>
                        }
                        else
                        {
                            <span class="px-3 py-1 bg-white/5 rounded opacity-50 text-xs font-bold text-white/50 cursor-not-allowed">PREV</span>
                        }

                        <span class="text-xs font-ibm-plex-mono text-white/50">Pg @Model.ReviewComments.PageIndex / @Model.ReviewComments.TotalPages</span>

                        @if (Model.ReviewComments.HasNextPage)
                        {
                            <a href="/admin?commentPage=@(Model.ReviewComments.PageIndex + 1)&reviewPage=@Model.Reviews.PageIndex&gamePage=@Model.Games.PageIndex&userPage=@Model.Users.PageIndex" class="px-3 py-1 bg-white/5 rounded hover:bg-white/10 text-xs font-bold text-white">NEXT</a>
                        }
                        else
                        {
                            <span class="px-3 py-1 bg-white/5 rounded opacity-50 text-xs font-bold text-white/50 cursor-not-allowed">NEXT</span>
                        }
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>
</div>

<script>
(() => {
    const containerId = 'admin-dashboard-content';

    function getContainer(docOrEl) {
        return (docOrEl instanceof Document ? docOrEl : docOrEl.ownerDocument).getElementById(containerId);
    }

    async function fetchAndSwap(url, { pushState = true, method = 'GET', body = null } = {}) {
        const container = document.getElementById(containerId);
        if (!container) return;

        container.classList.add('opacity-70', 'pointer-events-none');
        try {
            const resp = await fetch(url, {
                method,
                body,
                credentials: 'same-origin',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            });

            const html = await resp.text();
            const doc = new DOMParser().parseFromString(html, 'text/html');
            const nextContainer = doc.getElementById(containerId);
            if (!nextContainer) {
                if (pushState) window.location.href = url;
                return;
            }

            container.innerHTML = nextContainer.innerHTML;
            if (pushState) {
                history.pushState({}, '', url);
            }
        } finally {
            container.classList.remove('opacity-70', 'pointer-events-none');
        }
    }

    document.addEventListener('click', (e) => {
        const container = document.getElementById(containerId);
        if (!container) return;

        const a = e.target.closest('a');
        if (!a || !container.contains(a)) return;
        if (a.target && a.target !== '_self') return;
        if (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey) return;

        let url;
        try {
            url = new URL(a.href, window.location.href);
        } catch {
            return;
        }

        if (url.origin !== window.location.origin) return;
        if (url.pathname !== '/admin') return;

        e.preventDefault();
        fetchAndSwap(url.toString(), { pushState: true });
    });

    document.addEventListener('submit', (e) => {
        const container = document.getElementById(containerId);
        if (!container) return;

        const form = e.target;
        if (!(form instanceof HTMLFormElement)) return;
        if (!container.contains(form)) return;

        let url;
        try {
            url = new URL(form.action, window.location.href);
        } catch {
            return;
        }

        if (url.origin !== window.location.origin) return;
        if (url.pathname !== '/admin' && !url.pathname.startsWith('/admin/')) return;

        e.preventDefault();

        const method = (form.method || 'POST').toUpperCase();
        const body = new FormData(form);
        fetchAndSwap(form.action, { pushState: false, method, body });
    });

    window.addEventListener('popstate', () => {
        if (window.location.pathname !== '/admin') return;
        fetchAndSwap(window.location.href, { pushState: false });
    });
})();
</script>

<script>
    function addTag(prefix, inputName) {
        var select = document.getElementById(prefix + '-select');
        var value = select.value;
        var text = select.options[select.selectedIndex].text;

        if (!value) return;

        // Check if already exists in list
        var inputsContainer = document.getElementById(prefix + '-inputs');
        if (inputsContainer.querySelector('input[value="' + value + '"]')) {
            alert('Already added!');
            return;
        }

        // Add visual tag
        var tagsList = document.getElementById(prefix + '-tags');
        var tag = document.createElement('div');
        tag.className = 'px-2 py-1 rounded bg-blue-500/20 text-blue-400 text-xs font-bold flex items-center gap-1 animate-in zoom-in-50 duration-200';
        tag.setAttribute('data-id', value);
        // Using innerHTML for simplicity in this script block
        tag.innerHTML = text + ' <span class="hover:text-white cursor-pointer" onclick="removeTag(this, \'' + prefix + '\', \'' + value + '\')">×</span>';
        tagsList.appendChild(tag);

        // Add hidden input
        var input = document.createElement('input');
        input.type = 'hidden';
        input.name = inputName;
        input.value = value;
        input.id = 'input-' + prefix + '-' + value;
        inputsContainer.appendChild(input);

        // Reset select
        select.value = "";
    }

    function removeTag(element, prefix, value) {
        // Remove visual tag (parent of the span clicked)
        element.parentElement.remove();

        // Remove hidden input
        var input = document.getElementById('input-' + prefix + '-' + value);
        if (input) input.remove();
    }
</script>

@section Styles {
    <style type="text/tailwindcss">
        .admin-input {
            @@apply w-full bg-black/20 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-primary focus:bg-white/5 hover:border-white/30 transition-all font-medium text-sm;
        }
        .admin-select {
            @@apply bg-black/20 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-primary focus:bg-white/5 hover:border-white/30 transition-all font-medium text-sm;
        }
        .admin-btn-base {
            @@apply font-bold uppercase tracking-wider px-6 py-3 rounded-lg transition-all text-xs;
        }
        .admin-btn-primary {
            @@apply font-bold uppercase tracking-wider px-6 py-3 rounded-lg transition-all text-xs bg-primary text-background-dark hover:bg-white hover:text-black;
        }
        .admin-btn-secondary {
            @@apply px-4 py-2 rounded-lg bg-white/5 hover:bg-white/10 text-white text-xs font-bold uppercase tracking-wider border border-white/10 transition-colors;
        }
        .admin-file-input {
             @@apply block w-full text-xs text-white/50 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-xs file:font-bold file:uppercase file:bg-white/10 file:text-white hover:file:bg-primary hover:file:text-black hover:file:cursor-pointer transition-all;
        }
    </style>
}
